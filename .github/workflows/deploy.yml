name: ğŸš€ Deploy a VPS con build en servidor

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Ejecutar deploy remoto
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ” Decodificar clave privada del VPS
        run: |
          echo "${{ secrets.VPS_KEY_BASE64 }}" | base64 -d > id_rsa
          chmod 600 id_rsa

      - name: ğŸ” Conectar por SSH y ejecutar comandos
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USER }}
          key_path: ./id_rsa
          port: 5755
          script: |
            echo "ğŸ“ Entrando al proyecto"
            cd /var/www/matescode || exit 1

            echo "ğŸŒ€ Stasheando cambios locales"
            git stash || exit 1

            echo "â¬‡ï¸ Actualizando cÃ³digo"
            git pull || exit 1

            echo "ğŸ§¹ Borrando carpeta dist"
            rm -rf dist || exit 1

            echo "ğŸ“¦ Instalando dependencias"
            npm install || exit 1

            echo "âš™ï¸ Ejecutando build"
            npm run build || exit 1

            echo "âœ… Deploy completado con Ã©xito"
